package itsm

import (
	"strings"

	"github.com/AlecAivazis/survey/v2"
	"mmesh.dev/m-api-go/grpc/resources/itsm"
	"mmesh.dev/m-cli/pkg/input"
)

const (
	feedbackGeneralComments string = "general comments"
	feedbackFeatureRequest  string = "feature request"
)

// customer feedback
func (api *API) Feedback() {
	submitIssue(itsm.IssueType_FEEDBACK, itsm.IssueSubtype_FEEDBACK_GENERAL_COMMENTS)
}

func getFeedbackType() itsm.IssueSubtype {
	feedbackSubtypes := map[string]itsm.IssueSubtype{
		feedbackGeneralComments: itsm.IssueSubtype_FEEDBACK_GENERAL_COMMENTS,
		feedbackFeatureRequest:  itsm.IssueSubtype_FEEDBACK_FEATURE_REQUEST,
	}

	iTypeOpts := make([]string, 0)
	for iType := range feedbackSubtypes {
		iOpt := strings.Title(iType)
		iTypeOpts = append(iTypeOpts, iOpt)
	}

	iType := input.GetSelect("Select Feedback Type:", "", iTypeOpts, survey.Required)

	return feedbackSubtypes[strings.ToLower(iType)]
}
