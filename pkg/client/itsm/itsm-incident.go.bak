package itsm

import (
	"strings"

	"github.com/AlecAivazis/survey/v2"
	"mmesh.dev/m-api-go/grpc/resources/itsm"
	"mmesh.dev/m-cli/pkg/input"
)

const (
	incidentBilling  string = "billing"
	incidentPlatform string = "platform"
)

// incident
func (api *API) Incident() {
	submitIssue(itsm.IssueType_INCIDENT, itsm.IssueSubtype_UNSPECIFIED_OTHER)
}

func getIncidentType() itsm.IssueSubtype {
	incidentSubtypes := map[string]itsm.IssueSubtype{
		incidentBilling:  itsm.IssueSubtype_INCIDENT_BILLING,
		incidentPlatform: itsm.IssueSubtype_INCIDENT_PLATFORM,
	}

	iTypeOpts := make([]string, 0)
	for iType := range incidentSubtypes {
		iOpt := strings.Title(iType)
		iTypeOpts = append(iTypeOpts, iOpt)
	}

	iType := input.GetSelect("Select Incident Type:", "", iTypeOpts, survey.Required)

	return incidentSubtypes[strings.ToLower(iType)]
}
