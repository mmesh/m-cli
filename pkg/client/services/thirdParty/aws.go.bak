package thirdParty

import (
	"fmt"
	"strings"

	"github.com/AlecAivazis/survey/v2"
	"mmesh.dev/m-api-go/grpc/resources/services/thirdParty"
	"mmesh.dev/m-cli/pkg/input"
	"mmesh.dev/m-cli/pkg/output"
)

func (a *API) AWS(aws *thirdParty.AWS) *thirdParty.AWS {
    fmt.Println()
    
	output.Header("Amazon Web Services Setup")

	if aws == nil {
		aws = &thirdParty.AWS{}
	}

	if aws.Enabled {
		if input.GetConfirm("Delete AWS integration?", false) {
			aws = &thirdParty.AWS{}
		}
	}

	if input.GetConfirm("Configure AWS integration?", true) {
		fmt.Println()

		setAWSConfig(aws)
	}

	return aws
}

func setAWSConfig(aws *thirdParty.AWS) {
    aws.AccessKeyID = strings.TrimSpace(input.GetInput(
        "AWS Access Key ID:",
        "",
        aws.AccessKeyID,
        survey.Required,
    ))
    aws.SecretKey = strings.TrimSpace(input.GetMultiline(
        "AWS Secret Key:",
        "",
        string(aws.SecretKey),
        survey.Required,
    ))
    aws.Enabled = true
}
